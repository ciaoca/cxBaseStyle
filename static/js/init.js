"use strict";

// __init/global.js
window.GLOBAL={version:"1.0.0",prefix:"",dom:{},platform:{},template:{},mediaMode:"mobile",url:{base:"/cxm/",cityData:"/cxm/static/plugins/cxSelect/json/cityData.min.json"},urlHashTag:"!",pagesConfig:{code:"{{count}}{{cur}}{{number}}{{prev}}{{next}}",numberLength:3}},1024<window.innerWidth?(GLOBAL.mediaMode="pc",GLOBAL.pagesConfig.code="{{count}}{{cur}}{{first}}{{last}}{{number}}{{prev}}{{next}}",GLOBAL.pagesConfig.numberLength=9):640<window.innerWidth&&(GLOBAL.mediaMode="pad",GLOBAL.pagesConfig.code="{{count}}{{cur}}{{number}}{{prev}}{{next}}",GLOBAL.pagesConfig.numberLength=5),GLOBAL.tabBarConfig={home:{name:"首页",link:GLOBAL.url.base+"docs/view/about/index.html"},module:{name:"组件",link:GLOBAL.url.base+"docs/view/module/index.html"},example:{name:"实例",link:GLOBAL.url.base+"docs/view/example/index.html"},more:{name:"更多",sub:{github:{name:"Github",link:"https://github.com/ciaoca/cxm"},plugins:{name:"插件列表",link:GLOBAL.url.base+"docs/view/about/plugins.html"},test:{name:"测试",link:GLOBAL.url.base+"docs/view/test/index.html"}}}},function(){const e=navigator.userAgent.toLowerCase();let t;GLOBAL.platform.isHttps=!("https:"!==document.location.protocol),/(iphone|ipad|ipod|ios)/i.test(e)?(t=e.match(/os\s([\d\.\_]+)/i),GLOBAL.platform.system="ios"):/android/i.test(e)?(t=e.match(/android\s([\d\.]+)/i),GLOBAL.platform.system="android"):/windows nt/i.test(e)?(t=e.match(/windows nt\s([\d\.]+)/i),GLOBAL.platform.system="windows"):/mac os x/i.test(e)&&(t=e.match(/mac os x\s([\d\.]+)/i),GLOBAL.platform.system="mac"),Array.isArray(t)&&1<t.length&&(GLOBAL.platform.version=parseFloat(t[1].replace(/[\-\_]/g,"."))),/micromessenger/i.test(e)?(t=e.match(/micromessenger\/([\d\.]+)/i),GLOBAL.platform.browser="wechat"):/chrome/i.test(e)?(t=e.match(/chrome\/([\d\.]+)/i),GLOBAL.platform.browser="chrome"):/safari/i.test(e)?(t=e.match(/version\/([\d\.]+)/i),GLOBAL.platform.browser="safari"):/msie/i.test(e)?(t=e.match(/msie\s([\d\.]+)/i),GLOBAL.platform.browser="ie"):/trident/i.test(e)&&(t=e.match(/rv:([\d\.]+)/),GLOBAL.platform.browser="ie"),Array.isArray(t)&&1<t.length&&(GLOBAL.platform.browserVersion=parseFloat(t[1].replace(/[\-\_]/g,".")))}(),function(){let e=location.hash;var t="#"+GLOBAL.urlHashTag;0===e.indexOf(t)?(e=(e=location.href).replace(t,"#"),GLOBAL.purl=purl(e)):GLOBAL.purl=purl()}(),WebApp.setOptions({prefix:GLOBAL.prefix,hashTag:GLOBAL.urlHashTag});


// __init/template.js
template.defaults.imports.tfIsString=function(e){return WebApp.isString(e)},template.defaults.imports.tfIsNumber=function(e){return WebApp.isNumber(e)},template.defaults.imports.tfIsArray=function(e){return WebApp.isArray(e)},template.defaults.imports.tfInArray=function(e,t){return!!(Array.isArray(t)&&0<=t.indexOf(e))},template.defaults.imports.tfReplace=function(e,t,a){return e=(e=WebApp.isString(e)?e:String(e)).length?e.replace(new RegExp(t,"gi"),a):e},template.defaults.imports.tfReplaceEnter=function(){return WebApp.replaceEnter.apply(WebApp,arguments)},template.defaults.imports.tfNumberFormat=function(){return WebApp.isNumber(arguments[0])?WebApp.numberFormat.apply(WebApp,arguments):arguments[0]},template.defaults.imports.tfDate=function(e,t){return!WebApp.isNumber(e)||e<=0?"-":dayjs(e).format(t)},template.defaults.imports.tfGetWeekName=function(e){let t=WebApp.isNumber(e)?e:parseInt(e,10);return isNaN(t)?e:(7<=t?t%=7:t<0&&(t=Math.abs(t)),t=["周日","周一","周二","周三","周四","周五","周六"][key])},template.defaults.imports.tfEncodeURIComponent=function(e){return encodeURIComponent(e)},template.defaults.imports.tfUrlAddQuery=function(e,t){return e="string"==typeof t&&t.length?e+(0<=e.indexOf("?")?"&":"?")+t:e},GLOBAL.template.footerNav=`<nav>{{each data item alias}}{{if item.sub}}<dl class="col {{alias}}{{if target == alias}} n{{/if}}"><dt><a href="javascript://" rel="sub">{{item.name}}</a></dt><dd>{{each item.sub val key}}<a class="{{key}}" {{if val.link}}href="{{val.link}}"{{else}}href="javascript://" rel="{{key}}"{{/if}}>{{val.name}}</a>{{/each}}</dd></dl>{{else}}<a class="col {{alias}}{{if target == alias}} n{{/if}}" {{if item.link}}href="{{item.link}}"{{else}}href="javascript://" rel="{{alias}}"{{/if}}>{{item.name}}</a>{{/if}}{{/each}}</nav>`,GLOBAL.template.filterTool=`<a class="bgclose" href="javascript://" rel="close"></a><nav>{{each data item alias}}<dl class="col {{alias}}"><dt data-title="{{item.title}}">{{if (item.default && item.default.title)}}{{item.default.title}}{{else}}{{item.title}}{{/if}}</dt>{{if item.list}}<dd{{if item.cols}} class="a_col a_col_{{item.cols}}"{{/if}}>{{each item.list val bIndex}}<a{{if ((item.default && item.default.value == val.value) || ((!item.default || !item.default.value) && bIndex === 0 && !val.value))}} class="n"{{/if}} href="javascript://" rel="filter_{{alias}}" rev="{{val.value}}" data-title="{{val.title}}">{{val.title}}</a>{{/each}}</dd>{{else if item.sub}}<dd class="sub_col">{{each item.sub val bIndex}}<dl class="row"><dt>{{if !val.sub || !val.sub.length}}<a{{if ((item.default && item.default.value == val.value) || ((!item.default || !item.default.value) && !val.value))}} class="n"{{/if}} href="javascript://" rel="filter_{{alias}}" rev="{{val.value}}" data-title="{{val.title}}">{{val.title}}</a>{{else}}{{val.title}}{{/if}}</dt><dd>{{each val.sub child}}<a{{if (item.default && item.default.value == child.value)}} class="n"{{/if}} href="javascript://" rel="filter_{{alias}}" rev="{{child.value}}" data-title="{{child.title}}">{{child.title}}</a>{{/each}}</dd></dl>{{/each}}</dd>{{/if}}</dl>{{/each}}</nav>`;


// __init/plugins.js
GLOBAL.platform&&"ios"===GLOBAL.platform.system&&document.addEventListener("DOMContentLoaded",()=>{FastClick.attach(document.body)},!1),$.cxDialog&&($.cxDialog.defaults.baseClass="ios",$.cxDialog.defaults.title="提示",$.cxDialog.defaults.ok=()=>{}),"function"==typeof Notyf&&(window.notyf=new Notyf({ripple:!1,position:{x:"center",y:"top"},types:[{type:"success",className:"notyf-cxm-success",background:"rgba(140, 193, 82, 0.9)",icon:{}},{type:"info",className:"notyf-cxm-info",background:"rgba(51, 51, 51, 0.9)",icon:{}},{type:"warn",className:"notyf-cxm-warn",background:"rgba(254, 153, 57, 0.9)",icon:{}},{type:"error",className:"notyf-cxm-error",background:"rgba(218, 68, 83, 0.9)",icon:{}}]}),cxValidation&&cxValidation.setOptions({complete:e=>{notyf.dismissAll()},error:e=>{notyf.open({type:"info",message:e.message}),"input"===e.element.nodeName.toLowerCase()&&-1!==["radio","checkbox","color","range","file"].indexOf(e.element.type)||e.element.focus()}})),$.cxSelect&&($.cxSelect.defaults.url=GLOBAL.url.cityData),$.cxCalendar&&"mobile"===GLOBAL.mediaMode&&($.cxCalendar.defaults.position="fixed",$.cxCalendar.defaults.baseClass="fixed");


// __init/page.js
!function(){const e={config:{},dom:{},init:function(){var e=this;e.dom.body=document.body,WebApp.isObject(window.PageConfig)?Object.assign(e.config,window.PageConfig):window.PageConfig={},WebApp.isElement(document.getElementById("tabbar"))&&(GLOBAL.dom.tabbar=WebApp.initTabBar(document.getElementById("tabbar"),GLOBAL.tabBarConfig)),e.buildBackUrl(),e.buildPageQrcode(),e.bindBodyEvent(),e.fixInputFixed()},buildBackUrl:function(){if(document.getElementById("header_back")){var e=this,t=GLOBAL.purl.param("backurl");if(e.dom.headerBack=document.getElementById("header_back"),WebApp.isString(t)&&t.length)if("_none"===t)e.dom.headerBack.style.display="none";else if("_back"===t){const o=new RegExp("^http(s?)://"+location.host+"/");document.referrer&&o.test(document.referrer)&&(e.dom.headerBack.href="javascript:history.back();")}else e.dom.headerBack.href=decodeURIComponent(t)}},buildPageQrcode:function(){if("pc"===GLOBAL.mediaMode){const t=document.createElement("div");var e=document.createElement("div");new QRCode(e,{text:encodeURI(location.href),width:88,height:88,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L});t.classList.add("page_qrcode"),t.appendChild(e),t.insertAdjacentHTML("beforeend","<p>在手机上浏览</p>"),this.dom.body.appendChild(t)}},bindBodyEvent:function(){this.dom.body.addEventListener("click",e=>{const t=e.target;if("a"===t.nodeName.toLowerCase()){var o=t.rel,n=t.rev;const d=t.dataset.option;try{d=JSON.parse(d)}catch(e){}"call_panel"===o&&(event.preventDefault(),WebApp.panelToggle(n,d))}})},fixInputFixed:function(){if(!GLOBAL.platform||"ios"===GLOBAL.platform.system){const t=this,o=e=>{var t=e.target.nodeName.toLowerCase();let o=!1;return 0<=["input","textarea","select"].indexOf(t)&&!e.target.readOnly&&!e.target.disabled&&("input"===t?["checkbox","radio","file","button","submit","reset","image","range"].indexOf(e.target.type)<=-1&&(o=!0):"textarea"!==t&&"select"!==t||(o=!0)),o};t.dom.body.addEventListener("focus",function(e){o(e)&&!t.dom.body.classList.contains("onfocus")&&t.dom.body.classList.add("onfocus")},!0),t.dom.body.addEventListener("blur",function(e){o(e)&&t.dom.body.classList.remove("onfocus")},!0)}}};document.addEventListener("DOMContentLoaded",()=>{e.init()})}();
