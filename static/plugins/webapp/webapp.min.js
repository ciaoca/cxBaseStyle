/**
 * webapp.js
 * @author ciaoca
 * @email ciaoca@gmail.com
 * @site https://github.com/ciaoca/cxm
 * @license Released under the MIT license
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.WebApp=e()}("undefined"!=typeof self?self:this,function(){"use strict";function t(){return this.init.apply(this,arguments)}return t.prototype.init=function(t){var e=this;e.options={prefix:"",hashTag:"!"},e.dom={},e.dom.loading=document.createElement("div"),e.dom.loading.setAttribute("id","app_loading"),e.panelCount=0},t.prototype.setOptions=function(t){Object.assign(this.options,t)},t.prototype.getDom=function(t,e){var o=this;let r;return o.isJquery(t)||o.isZepto(t)?e?t:t[0]:(o.isString(t)&&t.length?r=document.getElementById(t):o.isElement(t)&&(r=t),r=e&&o.isElement(r)?$(r):r)},t.prototype.closest=function(t,e){const o=t.matches||t.webkitMatchesSelector;for(;t;){if(o.call(t,e))return t;t=t.parentElement}return null},t.prototype.isIos=function(){return/(iphone|ipad|ipod|ios)/i.test(navigator.userAgent.toLowerCase())},t.prototype.isElement=function(t){return!(!t||"function"!=typeof HTMLElement&&"object"!=typeof HTMLElement||!(t instanceof HTMLElement))||!(!t||!t.nodeType||1!==t.nodeType)},t.prototype.isJquery=function(t){return!!(t&&t.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&t instanceof jQuery)},t.prototype.isZepto=function(t){return!(!t||!t.length||"function"!=typeof Zepto&&"object"!=typeof Zepto||!Zepto.zepto.isZ(t))},t.prototype.isString=function(t){return"string"==typeof t},t.prototype.isNumber=function(t){return!("number"!=typeof t||!isFinite(t))},t.prototype.isBoolean=function(t){return"boolean"==typeof t},t.prototype.isFunction=function(t){return"function"==typeof t},t.prototype.isArray=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},t.prototype.isObject=function(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)&&!(t.constructor&&!Object.prototype.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))},t.prototype.isNull=function(t){return"[object Null]"===Object.prototype.toString.call(t)},t.prototype.isUndefined=function(t){return"[object Undefined]"===Object.prototype.toString.call(t)},t.prototype.isDate=function(t){return t instanceof Date||"[object Date]"===Object.prototype.toString.call(t)},t.prototype.isLeapYear=function(t){return!!this.isNumber(t)&&!(t%(t%100?4:400))},t.prototype.isRegExp=function(t){return t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)},t.prototype.isError=function(t){return t instanceof Error},t.prototype.isJson=function(t){try{JSON.parse(t)}catch(t){return!1}return!0},t.prototype.isHidden=function(t){if(this.isElement(t)){const e=window.getComputedStyle(t);return"none"===e.getPropertyValue("display")||"hidden"===e.getPropertyValue("visibility")||0==e.getPropertyValue("opacity")||0==e.getPropertyValue("width")&&0==e.getPropertyValue("height")}return!0},t.prototype.isVisible=function(t){return!this.isHidden(t)},t.prototype.setStorage=function(t,e){this.isString(t)&&t.length&&sessionStorage.setItem(this.options.prefix+t,JSON.stringify(e))},t.prototype.getStorage=function(e){if(!this.isString(e)||!e.length)return null;e=sessionStorage.getItem(this.options.prefix+e);try{return JSON.parse(e)}catch(t){return e}},t.prototype.removeStorage=function(t){this.isString(t)&&t.length&&sessionStorage.removeItem(this.options.prefix+t)},t.prototype.clearStorage=function(){const t=sessionStorage;var e,o=this.options.prefix.length;for(e in t)e.slice(0,o)===this.options.prefix&&t.removeItem(e)},t.prototype.setLocalStorage=function(t,e){this.isString(t)&&t.length&&localStorage.setItem(this.options.prefix+t,JSON.stringify(e))},t.prototype.getLocalStorage=function(e){if(!this.isString(e)||!e.length)return null;e=localStorage.getItem(this.options.prefix+e);try{return JSON.parse(e)}catch(t){return e}},t.prototype.removeLocalStorage=function(t){this.isString(t)&&t.length&&localStorage.removeItem(this.options.prefix+t)},t.prototype.clearLocalStorage=function(){const t=localStorage;var e,o=this.options.prefix.length;for(e in t)e.slice(0,o)===this.options.prefix&&t.removeItem(e)},t.prototype.toFloat=function(t,e){return this.isNumber(t)||(t=parseFloat(t,10)),this.isNumber(e)||(e=0),Math.round(Math.round(t*Math.pow(10,e+1))/10)/Math.pow(10,e)},t.prototype.numberFormat=function(t,e){const o={decimals:0,fillZero:!1,decimalPoint:".",separator:","},r=(this.isNumber(e)?o.decimals=e:this.isObject(e)&&Object.assign(o,e),(t=(t=this.toFloat(t,o.decimals)).toFixed(o.decimals)).split("."));return this.isString(o.separator)&&o.separator.length&&(r[0]=r[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+o.separator)),0<o.decimals&&1<r.length&&(o.fillZero||(r[1]=r[1].replace(/0+$/,""))),t=1<r.length&&r[1].length?r.join(o.decimalPoint):r[0]},t.prototype.arrayUnique=function(o){if(!this.isArray(o))return o;const r=[],n={};for(let t=0,e;null!=(e=o[t]);t++)n[e]||(r.push(e),n[e]=!0);return r},t.prototype.getArraySubValue=function(t){let e;if(this.isArray(t.list)&&t.list.length)for(var o of t.list)if(t.query===o[t.src]){e=o[t.to];break}return void 0===e?t.value:e},t.prototype.getObjectValue=function(t){var e;let o;if(!this.isString(t.keys))return t.value;t.keys=t.keys.split("."),o=this.isObject(t.scope)?t.scope:window;for(e of t.keys){if(this.isUndefined(o[e])){o=t.value;break}o=o[e]}return o},t.prototype.getRandomNumber=function(t,e){return this.isNumber(t)||(t=0),(e=this.isNumber(e)?e:0)<t&&(e=t),Math.round(Math.random()*(e-t)+t)},t.prototype.getRandomString=function(t,e){return this.isNumber(t)||(t=0),this.isString(e)&&e.length||(e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"),Array.apply(0,Array(t)).map(()=>e.charAt(Math.floor(Math.random()*e.length))).join("")},t.prototype.replaceEnter=function(t){return this.isString(t)?(t=t.replace(/\r\n/g,"<br>")).replace(/\r|\n/g,"<br>"):t},t.prototype.replaceQuot=function(t,e){return this.isString(t)?!0===e?(t=t.replace(/&#34;/g,'"')).replace(/&#39;/g,"'"):(t=t.replace(/"/g,"&#34;")).replace(/'/g,"&#39;"):t},t.prototype.replaceHtml=function(t,e){return this.isString(t)?(t=t.trim(),!0===e?(t=(t=t.replace(/&#34;/g,'"')).replace(/&#39;/g,"'")).replace(/&#60;/g,"<"):(t=(t=t.replace(/"/g,"&#34;")).replace(/'/g,"&#39;")).replace(/</g,"&#60;")):t},t.prototype.loadingShow=function(t){var e=this;const o={text:"",mask:!0};e.isString(t)?o.text=t:e.isObject(t)&&Object.assign(o,t),e.isString(o.text)&&o.text.length?e.dom.loading.setAttribute("title",o.text):e.dom.loading.removeAttribute("title"),o.mask?e.dom.loading.classList.remove("notmask"):e.dom.loading.classList.add("notmask"),document.body.appendChild(e.dom.loading)},t.prototype.loadingHide=function(){document.body.contains(this.dom.loading)&&document.body.removeChild(this.dom.loading)},t.prototype.loadingToggle=function(t){document.body.contains(this.dom.loading)?this.loadingHide():this.loadingShow(t)},t.prototype.panelShow=function(t,e){const o=this.getDom(t);if(o){t=Object.assign({lock:!0,blur:!1},e);o.classList.remove("out"),o.classList.contains("in")||(this.panelCount++,o.classList.add("in"));const r=[];return t.lock&&r.push("lock"),t.blur&&r.push("blur"),r.length&&document.documentElement.classList.add(...r),o}},t.prototype.panelHide=function(t){var e=this;const o=e.getDom(t);if(o)return o.classList.remove("in"),o.classList.contains("out")||(e.panelCount--,o.classList.add("out")),e.panelCount<0&&(e.panelCount=0),e.panelCount<=0&&document.documentElement.classList.remove("lock","blur"),o},t.prototype.panelToggle=function(t,e){const o=this.getDom(t);o&&(o.classList.contains("in")?this.panelHide(o):this.panelShow(o,e))},t.prototype.initTabBar=function(t,e,o){const r=this.getDom(t);if(r)return r.addEventListener("click",t=>{const e=t.target;t=e.nodeName.toLowerCase();if("a"===t&&"sub"===e.rel){event.preventDefault();const o=e.parentNode;o.classList.contains("hover")?o.classList.remove("hover"):o.classList.add("hover")}}),this.isObject(e)&&this.buildTabBar(r,e,o),r},t.prototype.buildTabBar=function(t,e,o){const r=this.getDom(t);if(r){!this.isString(o)&&r.dataset.target&&(o=r.dataset.target);const n=template.compile(GLOBAL.template.footerNav);t=n({data:e,target:o});return r.innerHTML=t,r}},t.prototype.initFilterTool=function(t,e){const c=this,u=c.getDom(t);if(u)return u.addEventListener("click",o=>{const r=o.target;o=r.nodeName.toLowerCase();if("dt"===o){const l=r.parentNode;var t=l.classList.contains("hover");if(l.classList.contains("col")){for(var e of l.parentNode.children)"dl"===e.nodeName.toLowerCase()&&e.classList.remove("hover");t?(u.classList.remove("hover"),l.classList.remove("hover")):(u.classList.add("hover"),l.classList.add("hover"))}else if(l.classList.contains("row")&&!t){for(var n of l.parentNode.children)"dl"===n.nodeName.toLowerCase()&&n.classList.remove("hover");t?l.classList.remove("hover"):l.classList.add("hover")}}else if("a"===o){t=r.rel,o=r.rev;if(t){event.preventDefault(),u.classList.remove("hover");for(var i of u.querySelectorAll("dl"))i.classList.contains("col")&&i.classList.remove("hover");if("close"!==t){const p=c.closest(r,"dl.col");let t;for(var s of p.children)if("dt"===s.nodeName.toLowerCase()){t=s;break}let e=r.dataset.title;o&&c.isString(e)&&e.length||(e=t.dataset.title),t.innerHTML=e;for(var a of p.querySelectorAll("a"))a.classList.remove("n");r.classList.add("n")}}}}),c.isObject(e)&&c.buildFilterTool(u,e),u},t.prototype.buildFilterTool=function(t,e){const o=this.getDom(t);if(o){const r=template.compile(GLOBAL.template.filterTool);t=r({data:e});return o.innerHTML=t,o}},t.prototype.getFormData=function(t){t=this.getDom(t);if(t){const r=new FormData(t),n={};for(var e of r.entries()){var[e,o]=e;e in n?(this.isArray(n[e])||(n[e]=[n[e]]),n[e].push(o)):n[e]=o}return n}},t.prototype.createUrlHash=function(t,e,o){var r,n;const i={},s=[];let a="#";for(r in this.isArray(e)&&e.length||(e=Object.getOwnPropertyNames(t)),t)0<=e.indexOf(r)&&t[r]&&((n=String(t[r])).length&&(i[r]=n,s.push(r+"="+n)));s.length&&(a+=this.options.hashTag+s.join("&")),!0===o?history.pushState(i,document.title,a):history.replaceState(i,document.title,a)},t.prototype.removeUrlHash=function(t,e){const o=location.hash.replace(new RegExp("^#"+this.options.hashTag),"");var r,n=o.split("&");const i={};if(this.isArray(t)&&t.length)for(var s of n)s.indexOf("=")&&(r=s.slice(0,s.indexOf("=")),-1===t.indexOf(r)&&(i[r]=s.slice(s.indexOf("=")+1)));this.createUrlHash(i,[],e)},t.prototype.getPageHtml=function(t){var e,o,r=this;const n={code:"{{count}}{{cur}}{{first}}{{last}}{{number}}{{prev}}{{next}}",numberLength:9,language:{first:"首页",last:"末页",prev:"上一页",next:"下一页",countBefore:"共 ",countAfter:" 页",curBefore:"第 ",curAfter:" 页",sumBefore:"共 ",sumAfter:" 条",selectBefore:"",selectAfter:"条/页"}};let i="";for(e in t)r.isArray(t[e])?n[e]=Array.from(t[e]):r.isObject(t[e])?e in n?Object.assign(n[e],t[e]):n[e]=Object.assign({},t[e]):n[e]=t[e];if(!r.isNumber(n.page)||!r.isNumber(n.pageCount)||n.page<1||n.pageCount<1)return i;const s={sum:'<span class="sum">'+n.language.sumBefore+n.sum+n.language.sumAfter+"</span>",count:'<span class="count">'+n.language.countBefore+n.pageCount+n.language.countAfter+"</span>",cur:'<span class="cur">'+n.language.curBefore+n.page+n.language.curAfter+"</span>",sizeSet:"",number:"",prev:"",next:"",first:"",last:""};if(r.isArray(n.sizeList)&&n.sizeList.length){s.sizeSet='<select class="select" name="'+n.rel+'_size">';for(var a of n.sizeList)s.sizeSet+='<option value="'+a+'"',n.sizeSet===a&&(s.sizeSet+=" selected"),s.sizeSet+=">"+n.language.selectBefore+a+n.language.selectAfter+"</option>";s.sizeSet+="</select>"}if(1<n.pageCount){r.isString(n.url)?(s.prev='<a href="'+n.url+(n.page-1)+'">'+n.language.prev+"</a>",s.next='<a href="'+n.url+(n.page+1)+'">'+n.language.next+"</a>",s.first='<a href="'+n.url+'1">'+n.language.first+"</a>",s.last='<a href="'+n.url+n.pageCount+'">'+n.language.last+"</a>"):r.isString(n.rel)&&(s.prev='<a href="javascript://" rel="'+n.rel+'" rev="'+(n.page-1)+'">'+n.language.prev+"</a>",s.next='<a href="javascript://" rel="'+n.rel+'" rev="'+(n.page+1)+'">'+n.language.next+"</a>",s.first='<a href="javascript://" rel="'+n.rel+'" rev="1">'+n.language.first+"</a>",s.last='<a href="javascript://" rel="'+n.rel+'" rev="'+n.pageCount+'">'+n.language.last+"</a>"),1===n.page?(s.prev="",s.first=""):n.page===n.pageCount&&(s.next="",s.last="");let e=1,o=1;o=n.pageCount<=n.numberLength?(e=1,n.pageCount):n.page<=Math.floor(n.numberLength/2)?(e=1,n.numberLength):n.pageCount-n.page<Math.floor(n.numberLength/2)?(e=n.pageCount-n.numberLength+1,n.pageCount):(e=n.page-Math.floor(n.numberLength/2),n.page+Math.floor(n.numberLength/2)),e<1&&(e=1),o>n.pageCount&&(o=n.pageCount);for(let t=e;t<=o;t++)t===n.page?s.number+="<strong>"+t+"</strong>":r.isString(n.url)?s.number+='<a href="'+n.url+t+'">'+t+"</a>":r.isString(n.rel)&&(s.number+='<a href="javascript://" rel="'+n.rel+'" rev="'+t+'">'+t+"</a>")}for(o in i=n.code,s)i=i.replace("{{"+o+"}}",s[o]);return i},t.prototype.compressPicture=function(t,e,o){const r=this,n=document.createElement("canvas");let i=[];const s=[],a=Object.assign({maxWidth:0,maxHeight:0,quality:.8,fileType:""},e);if("[object FileList]"===Object.prototype.toString.call(t)?i=Array.from(t):"[object File]"===Object.prototype.toString.call(t)&&i.push(t),!i.length)return void console.warn("[compressPicture] Not File");const l=()=>{const o=i.shift();let r=a.fileType||o.type;r=r||"image/jpeg",EXIF.getData(o,function(){var t=EXIF.getTag(this,"Orientation");const e=new MegaPixImage(o);e.render(n,{maxWidth:a.maxWidth,maxHeight:a.maxHeight,orientation:t}),setTimeout(()=>{s.push(n.toDataURL(r,a.quality)),(i.length?l:p)()},200)})},p=()=>{r.isFunction(o)&&o(s)};l()},new t});